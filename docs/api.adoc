= Web API Documentation
:version: 1.0
:revdate: {docdate}
:toc:
:toclevels: 3
:sectanchors:
:sectlinks:

== Overview

The AsciiDoc XML Converter provides a web service API for converting AsciiDoc documents to XML, HTML, or XHTML formats. The API is designed to be simple, RESTful, and easy to integrate into any application.

The web service runs on HTTP and provides endpoints for:

* Document conversion (XML, HTML5, XHTML5)
* Syntax validation
* File upload and retrieval
* XSLT template access

== Base URL

All API endpoints are relative to the base URL where the server is running. By default:

----
http://localhost:8005
----

== Endpoints

=== Convert AsciiDoc

Converts an AsciiDoc document to XML, HTML, or XHTML format.

==== Request

[source,http]
----
POST /api/convert
Content-Type: application/json
----

==== Request Body

The request body should be a JSON object with the following fields:

|===
|Field |Type |Required |Description

|`asciidoc`
|string
|Yes
|The AsciiDoc source content to convert

|`output`
|string
|No
|Output format: `xml`, `html`, `html5`, `xhtml`, or `xhtml5`. Default: `xml`
|===

==== Query Parameters

|===
|Parameter |Type |Required |Description

|`output`
|string
|No
|Alternative way to specify output format (overrides JSON body)

|`direct`
|boolean
|No
|If `true`, returns the converted content directly with appropriate Content-Type header instead of JSON response
|===

==== Example Request (JSON Response)

[source,bash]
----
curl -X POST http://localhost:8005/api/convert \
  -H "Content-Type: application/json" \
  -d '{
    "asciidoc": "= Hello World\n\nThis is a paragraph.",
    "output": "html"
  }'
----

==== Example Request (Direct Output)

[source,bash]
----
curl -X POST "http://localhost:8005/api/convert?direct=true" \
  -H "Content-Type: application/json" \
  -d '{
    "asciidoc": "= Hello World\n\nThis is a paragraph.",
    "output": "html"
  }'
----

==== Response (JSON Mode)

When `direct` parameter is not set or is `false`, the response is a JSON object:

[source,json]
----
{
  "output": "<html>...</html>",
  "contentType": "text/html; charset=utf-8",
  "type": "html"
}
----

|===
|Field |Type |Description

|`output`
|string
|The converted document content

|`contentType`
|string
|The MIME type of the output content

|`type`
|string
|The output format used (`xml`, `html`, or `xhtml`)
|===

==== Response (Direct Mode)

When `direct=true`, the response is the raw converted content with appropriate `Content-Type` header:

* `application/xml; charset=utf-8` for XML output
* `text/html; charset=utf-8` for HTML/HTML5 output
* `application/xhtml+xml; charset=utf-8` for XHTML/XHTML5 output

==== Status Codes

|===
|Code |Description

|200
|Conversion successful

|400
|Invalid request (missing or invalid JSON, unsupported output type)

|405
|Method not allowed (must be POST)

|500
|Internal server error (conversion failed)
|===

==== Supported Output Formats

|===
|Format |Description |Content-Type

|`xml`
|Custom XML format (default)
|`application/xml; charset=utf-8`

|`html` or `html5`
|HTML5 (loose format)
|`text/html; charset=utf-8`

|`xhtml` or `xhtml5`
|XHTML5 (well-formed XML)
|`application/xhtml+xml; charset=utf-8`
|===

=== Validate AsciiDoc

Validates AsciiDoc syntax without performing conversion.

==== Request

[source,http]
----
POST /api/validate
Content-Type: application/json
----

==== Request Body

[source,json]
----
{
  "asciidoc": "= Document Title\n\nContent here."
}
----

|===
|Field |Type |Required |Description

|`asciidoc`
|string
|Yes
|The AsciiDoc content to validate
|===

==== Example Request

[source,bash]
----
curl -X POST http://localhost:8005/api/validate \
  -H "Content-Type: application/json" \
  -d '{
    "asciidoc": "= Valid Document\n\nThis is valid."
  }'
----

==== Response (Valid)

[source,json]
----
{
  "valid": true
}
----

==== Response (Invalid)

[source,json]
----
{
  "valid": false,
  "error": "Error message describing the syntax issue"
}
----

|===
|Field |Type |Description

|`valid`
|boolean
|Whether the AsciiDoc syntax is valid

|`error`
|string
|Error message (only present when `valid` is `false`)
|===

==== Status Codes

|===
|Code |Description

|200
|Validation completed (check `valid` field in response)

|400
|Invalid request (missing or invalid JSON)

|405
|Method not allowed (must be POST)

|500
|Internal server error
|===

=== Get XSLT Template

Retrieves the default XSLT template used for transforming XML to HTML.

==== Request

[source,http]
----
GET /api/xslt
----

==== Example Request

[source,bash]
----
curl http://localhost:8005/api/xslt
----

==== Response

Returns the XSLT file content with `Content-Type: application/xml`.

[source,xml]
----
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
...
</xsl:stylesheet>
----

==== Status Codes

|===
|Code |Description

|200
|XSLT template retrieved successfully

|405
|Method not allowed (must be GET)

|500
|Internal server error (template file not found)
|===

=== Upload File

Uploads an AsciiDoc or XSLT file to the server.

==== Request

[source,http]
----
POST /api/upload
Content-Type: multipart/form-data
----

==== Form Fields

|===
|Field |Type |Required |Description

|`file`
|file
|Yes
|The file to upload (AsciiDoc or XSLT)

|`type`
|string
|Yes
|File type: `asciidoc` or `xslt`
|===

==== Example Request

[source,bash]
----
curl -X POST http://localhost:8005/api/upload \
  -F "file=@document.adoc" \
  -F "type=asciidoc"
----

==== Response

[source,json]
----
{
  "path": "/static/document.adoc",
  "filename": "document.adoc",
  "type": "asciidoc"
}
----

|===
|Field |Type |Description

|`path`
|string
|URL path to access the uploaded file

|`filename`
|string
|The filename of the uploaded file

|`type`
|string
|The file type (`asciidoc` or `xslt`)
|===

==== Status Codes

|===
|Code |Description

|200
|File uploaded successfully

|400
|Invalid request (missing file, invalid type, parse error)

|405
|Method not allowed (must be POST)

|500
|Internal server error (file save failed)
|===

==== Notes

* Maximum upload size: 10MB
* AsciiDoc files are saved with `.adoc` extension if not already present
* XSLT files are saved with `.xsl` extension if not already present
* Files are saved to the static directory and can be accessed via `/static/` path

=== Load File

Loads a file from the server's static directory or filesystem.

==== Request

[source,http]
----
GET /api/load-file?path=<file-path>
----

==== Query Parameters

|===
|Parameter |Type |Required |Description

|`path`
|string
|Yes
|Path to the file (relative to static directory or absolute)
|===

==== Example Request

[source,bash]
----
curl "http://localhost:8005/api/load-file?path=examples/comprehensive.adoc"
----

==== Response

Returns the file content with appropriate `Content-Type` header:

* `text/plain` for AsciiDoc files (`.adoc`, `.asciidoc`)
* `application/xml` for XSLT files (`.xsl`, `.xslt`)
* `text/plain` for other files

==== Status Codes

|===
|Code |Description

|200
|File loaded successfully

|400
|Invalid request (missing `path` parameter)

|404
|File not found

|405
|Method not allowed (must be GET)

|500
|Internal server error
|===

=== Get Documentation

Retrieves the user guide documentation rendered as HTML.

==== Request

[source,http]
----
GET /docs
----

==== Example Request

[source,bash]
----
curl http://localhost:8005/docs
----

==== Response

Returns HTML5 content with embedded navigation and styling.

[source,html]
----
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AsciiDoc XML Converter - Documentation</title>
    ...
</head>
<body>
    ...
</body>
</html>
----

==== Status Codes

|===
|Code |Description

|200
|Documentation retrieved successfully

|405
|Method not allowed (must be GET)

|500
|Internal server error (documentation file not found or conversion failed)
|===

=== Get Main Page

Retrieves the main Single Page Application (SPA) interface.

==== Request

[source,http]
----
GET /
----

==== Example Request

[source,bash]
----
curl http://localhost:8005/
----

==== Response

Returns the HTML for the interactive web interface.

== Error Responses

All endpoints may return error responses with the following structure:

=== Error Response Format

For JSON endpoints, errors are returned as plain text with appropriate HTTP status codes:

[source]
----
Error: <error message>
----

=== Common Error Codes

|===
|Code |Description

|400
|Bad Request - Invalid input or missing required parameters

|404
|Not Found - Resource does not exist

|405
|Method Not Allowed - HTTP method not supported for this endpoint

|500
|Internal Server Error - Server-side error occurred
|===

== CORS Policy

The API does not implement CORS restrictions by default. All endpoints accept cross-origin requests.

To enable CORS in your deployment, you may need to configure the web server or add CORS headers to the responses.

== Rate Limiting

Currently, the API does not implement rate limiting. In production deployments, consider adding rate limiting to prevent abuse.

== Authentication

The API does not require authentication by default. For production deployments, consider adding authentication middleware.

== Examples

=== JavaScript/TypeScript (Fetch API)

[source,javascript]
----
// Convert AsciiDoc to HTML
async function convertToHTML(asciidoc) {
  const response = await fetch('http://localhost:8005/api/convert', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      asciidoc: asciidoc,
      output: 'html'
    })
  });
  
  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`);
  }
  
  const data = await response.json();
  return data.output;
}

// Validate AsciiDoc
async function validateAsciiDoc(asciidoc) {
  const response = await fetch('http://localhost:8005/api/validate', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      asciidoc: asciidoc
    })
  });
  
  const data = await response.json();
  return data.valid;
}
----

=== Python (requests)

[source,python]
----
import requests

# Convert AsciiDoc to HTML
def convert_to_html(asciidoc):
    response = requests.post(
        'http://localhost:8005/api/convert',
        json={
            'asciidoc': asciidoc,
            'output': 'html'
        }
    )
    response.raise_for_status()
    return response.json()['output']

# Validate AsciiDoc
def validate_asciidoc(asciidoc):
    response = requests.post(
        'http://localhost:8005/api/validate',
        json={
            'asciidoc': asciidoc
        }
    )
    response.raise_for_status()
    return response.json()['valid']
----

=== Go (net/http)

[source,go]
----
package main

import (
    "bytes"
    "encoding/json"
    "io"
    "net/http"
)

// Convert AsciiDoc to HTML
func convertToHTML(asciidoc string) (string, error) {
    reqBody := map[string]string{
        "asciidoc": asciidoc,
        "output":   "html",
    }
    
    jsonData, err := json.Marshal(reqBody)
    if err != nil {
        return "", err
    }
    
    resp, err := http.Post(
        "http://localhost:8005/api/convert",
        "application/json",
        bytes.NewBuffer(jsonData),
    )
    if err != nil {
        return "", err
    }
    defer resp.Body.Close()
    
    body, err := io.ReadAll(resp.Body)
    if err != nil {
        return "", err
    }
    
    var result struct {
        Output string `json:"output"`
    }
    if err := json.Unmarshal(body, &result); err != nil {
        return "", err
    }
    
    return result.Output, nil
}
----

== Version Information

API version information is not currently exposed via an endpoint. The server version can be determined by checking the binary or documentation.

== Support

For issues, feature requests, or questions about the API, please refer to the main project documentation or repository.

